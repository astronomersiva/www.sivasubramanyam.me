const canvas=document.querySelector("canvas"),context=canvas.getContext("2d"),size=window.innerWidth/4,dpr=window.devicePixelRatio;canvas.width=size*dpr,canvas.height=size*dpr,context.scale(dpr,dpr),context.lineWidth=2,context.globalCompositeOperation="multiply";let rows,squareSize=window.innerWidth>800?30:10;for(let e=squareSize;e<=size-squareSize;e+=squareSize)rows+=1;let microphone,colors=["#B5838D","#E5989B","#E5989B","#F4ACB7","#F4ACB7","#FFCAD4","#FFCAD4","#ffdde4","#ffdde4"],rowsForEachColor=rows/colors.length;function draw(e,t,o){context.beginPath(),context.lineWidth=1,context.strokeStyle=colors[o]||colors[colors.length-1],context.rect(-e/2,-t/2,e,t),context.stroke()}function drawSquares(e=15,t=20){let o,n;for(context.clearRect(0,0,canvas.width,canvas.height),o=squareSize,n=0;o<=size-squareSize;o+=squareSize,n=0)for(let r=squareSize;r<=size-squareSize;r+=squareSize,n++){let i=Math.random()<.5?-1:1,a=r/size*Math.PI/180*i*Math.random()*t;i=Math.random()<.5?-1:1;let c=r/size*i*Math.random()*e;context.save(),context.translate(o+c,r),context.rotate(a),draw(squareSize,squareSize,n),context.restore()}}drawSquares();let toggle=document.querySelector(".pointer");function respondToAmbientNoise(){toggle.textContent="Stop Interaction ⏹️",toggle.onclick=stopResponding,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){let t=new AudioContext,o=t.createAnalyser();microphone=t.createMediaStreamSource(e);let n=t.createScriptProcessor(2048,1,1);o.smoothingTimeConstant=.8,o.fftSize=1024,microphone.connect(o),o.connect(n),n.connect(t.destination),n.onaudioprocess=function(){let e=new Uint8Array(o.frequencyBinCount);o.getByteFrequencyData(e);let t=0,n=e.length;for(let o=0;o<n;o++)t+=e[o];let r=t/n%20;drawSquares(r,r)}})).catch((function(e){}))}function stopResponding(){microphone.disconnect(),toggle.textContent="Start Interaction ▶️",toggle.onclick=respondToAmbientNoise}